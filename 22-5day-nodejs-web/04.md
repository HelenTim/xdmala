# 使用koa实现中间层以及分析现代前端架构

## ★TPR

### <mark>1）关于C#？</mark>

只要微软不GG，那么学习C#这门语言还是有口饭吃的……

**➹：**[C# 的前景如何？ - 知乎](https://www.zhihu.com/question/36993859)

### <mark>2）关于坚持？</mark>

学习要坚持，追女朋友也要坚持……

### <mark>3）关于全局安装和局部安装？</mark>

全局安装 -> nodemon、npm、yarn、nrm等这样的工具

局部安装 -> 看上边，非黑即白（webpack同样是推荐局部安装……）

### <mark>4）接口测试或者说是调试工具？</mark>

安装：

- REST Client -> VS Code自带 -> 当然，也可用Postman

使用：

- 根目录 -> touch .http -> .http用于测试接口 -> 变量：`@xxx` -> 使用变量 {{xxx}}

有了这个工具，可以让我们不用写页面去测试接口，直接：前端数据 -> url请求 -> 响应数据接口

### <mark>5）在Node.js 里边写的SQL语句？</mark>

一定要大写哈，虽然写小写也没事，但这是一种规范哈！

VS Code快捷键 -> `ctrl k ctrl s` -> 搜索「upper」即可 -> 我配置的快捷键 -> `ctrl j u`

### <mark>6）关于SQL语句？</mark>

SQL -> 关系型查询语句 -> 使用sql语句与数据库通信

## ★讲什么

1. API接口怎么去实现？
2. 中间层
3. 分析现代的web架构

经过前两次课的学习，你会发现今天讲的内容是多么的合理，就像是黑格尔说的那句话那样「存在即合理」。说白了，对比这三次课，你会发现当你一步一步、一个阶梯一个阶梯这样不断地解决各种问题，这其实就是一种进步哈！

收获 -> 思维从纯前端到一个具备初级的全栈思维

浏览器 -> 通信（url） -> 服务器

## ★接口

> 一个正常的服务器肯定是能处理接口的……

### <mark>1）搞个接口首页</mark>

1、mkdir api -> touch api/user.js

2、user.js -> require koa-router -> require md5-node -> 注册index路由，并暴露它 -> 在app.js文件里边使用该路由

### <mark>2）注册接口</mark>

1、user.js -> /register  -> 拿到前端用户名和密码数据 -> 数据库匹配数据，看看该用户是否存在 -> 存在，则不注册 -> 不存在，则注册之，即入库之

2、拿到前端数据 -> md5一下密码 -> await一下查询语句，等待data的结果 -> 判断data的长度 -> 大于0则返回数据给前端说「code:100，用户名已存在」 -> 小于0，则注册用户，即入库

3、注册用户 -> 数据格式校验（这里简单起见就不做了） -> sql -> insert语句 -> await insert语句结果res -> 判断res.affectedRows是否大于0 -> 大于0，则返回「code:200，message:'注册成功'」 -> 反之，报其它错误（如服务器内部错误等）或者什么也不做

## ★中间层

> 中间层是什么？ -> 先实现它，再来说说它到底是什么

### <mark>1）一个简单的中间层</mark>

> 画一个中间层

1、传统的开发模式 -> 浏览器与服务器通信 -> 前端 -> 发数据 -> 服务器 -> 查数据 -> 数据库 -> 返回数据 -> 服务器 -> 处理返回数据 -> 返回数据 -> 前端 -> 如登录功能 -> 前端输入用户名和密码 -> 把输入的数据交给后端的login路由 -> login路由拿到数据 -> 查询数据，看看数据是否已存在于数据库里边 -> 返回数据库处理的结果 -> 数据匹配，则返回登录成功 -> 否则，GG

![传统开发模式](assets/img/2020-01-19-18-03-01.png)

> 这是两层结构，不算数据库哈

2、有中间层的样子 -> 浏览器与服务器之间多了一层 -> 可谓是3层的样子

![有了中间层](assets/img/2020-01-19-18-09-57.png)











