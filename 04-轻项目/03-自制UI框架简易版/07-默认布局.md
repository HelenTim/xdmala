---
typora-copy-images-to: img\07
---

# 简单轮子：默认布局

## ★完善测试用例

### ◇注意点

- 在测试响应式，请这样来：

  ![1563032176326](img/07/1563032176326.png)

  > 表面上看2row，实际上是一个row，因为一个col占了1/3。而这里是一个row里边有6个col。
  >
  > 把屏幕尺寸大小当作是「JavaScript操控class的存在与否」一样。

- 一定要注意：元素身上的class名不要写错了，或者css里边的class名不要写错了，总之你写了个class，那么就得有与之相对应的css，不然，效果就不出来了，而这样显然是有bug的。像我就把 col元素的class为`col-narrow-pc-8`这样的搞成是 `col-narrowPc-8`这样的，起初没有留意到，还以为样式之所以不出现是浏览器缓存的问题呢！

- 我们的响应式弄得很简单，基本上就是布局方面的响应式，如在pc上，一行是3个div，而在手机上则是一行一个div。

- 一次很无厘头的错误：

  ![1563093570133](img/07/1563093570133.png)

  可以理解为模式匹配，左边是变量，而且可以给个默认值。

  况且一个对象得key会是直接一个字符串key吗？

  **➹：**[变量的解构赋值 - ECMAScript 6入门](http://es6.ruanyifeng.com/#docs/destructuring)

- 在写row.test.js的时候，如果你要让异步代码有效的话：

  ![1563098117871](img/07/1563098117871.png)

  > 不写done，意味着异步代码里边的回调不会执行，毕竟该页面已经关闭了。
  >
  > 测试gutter属性，对父组件和子组件的影响，算是比较麻烦了。总之，子组件也会受到父元素身上的属性影响的话，那么得用异步代码了，不然是子组件的style是咩有更新的，就像这样：
  >
  > ```html
  > <div data-v-db6887="" class="row" style="margin-left: -10px; margin-right: -10px;">
  >   
  >   <div data-v-ba2854="" class="col col-12" data-v-db6887="" style="padding-left: 0px; padding-right: 0px;"></div>
  >   
  >   <div data-v-ba2854="" class="col col-12" data-v-db6887="" style="padding-left: 0px; padding-right: 0px;"></div>
  >   
  > </div>
  > ```

  `vm.$el`为何物？

  ![1563098628417](img/07/1563098628417.png)

  

- 重新理解单元测试对代码的理解：

  ![1563098453366](img/07/1563098453366.png)

  > 不需要异步代码是因为，该align属性只作用于父组件，毕竟它就是flex容器哈！该row实例mounted到页面上就是这样编译过后的模板：
  >
  > ```html
  > <div data-v-db6887="" class="row align-right"></div>
  > ```
  >
  > 我稍微看了一下 `vm.$mount`这个API：
  >
  > - 它是把div这个元素给替换了，而替换的内容是Row.vue里边的模板呀！我之前以为这个模板是作为div这样元素的子元素而存在的。
  >
  > - 如果不写参数，那么模板将被渲染为文档之外的的元素，而且之后你打算挂载到文档里边的话，得使用原生 DOM API 把它插入文档中才可行：
  >
  >   ```js
  >   // 或者，在文档之外渲染并且随后挂载
  >   var component = new MyComponent().$mount() //返回实例自身
  >   document.getElementById('app').appendChild(component.$el)
  >   ```
  >
  >   这次是插入，而不是替换。
  >
  > **➹：** [API — Vue.js](https://cn.vuejs.org/v2/api/index.html#vm-mount)
  >
  > - `Node.remove()` 方法，把对象从它所属的DOM树中删除。
  >
  > **➹：** [demo](./demo/07/01-测试vm-mount这个api.html)

  再次 `vm.$el`

  ![1563099251009](img/07/1563099251009.png)

- 



### ◇How？

#### 解决「用户咩有写`:ipad`等自定义属性，然后样式选择」的问题

1. 写phone样式（默认就是这个样式），不写媒体查询之类的

2. 搞适配，只写 `min-width`，如ipad是 `≥576px`，那么其媒体查询就是 `@media (min-width: 576px) {}`

   同理，其它适配也是如此

3. 适配的样式是从小屏幕到大屏幕这样写下去的。

4. 测试







## ★总结

- 难怪一般为pc设计的设计稿都在992~1200之间。
- 始终注意不要把老师的理解给抄了
- 更改看视频方式：第一遍看就大致理解了，然后直接开始抄代码（进一步理解，并记录一些知识点）。第二遍就写上如何做到的，然后记上一些处理细节，总之是加深理解。



## ★Q&A

### ①JavaScript 里 创建 出来的DOm对象 怎么销毁它？

引子：

![1563106105246](img/07/1563106105246.png)

咩有API可以做到，自己被JavaScript的垃圾回收机制给回收掉。

而页面上的dom元素，倒是可以用 `xxx.remove()`这个API，DOM树里边的xxx元素给移除掉。

所以要让 `div.remove()`有意义的话，你得拿到Col组件的template的根元素，然后才能 `remove`掉。

**➹：**[JavaScript 里 new 出来的对象 怎么销毁它？ - 知乎](https://www.zhihu.com/question/21628109)

### ②只弄了两套设计稿，一套pc，一套手机，你说在ipad下看这个网页是应用哪套样式啊？

1. 你可以不管
2. 也可以让响应规则往下走

分析第二种做法：

![1563157456770](img/07/1563157456770.png)

> 粉红色线表示「样式应用的屏幕尺寸范围，其中phone所对应的这种样式应用最广泛」，思路主要是利用了CSS的层叠性。

1. 找到[断点](https://ant.design/components/grid-cn/#Col)——屏幕尺寸断点（一般太宽的如xxl是没有设计稿的，所以我们不需要做适配）

2. 假如一个断点范围内就写一个与之相应的样式（有最大值和最小值），如有5个断点范围，那就写5个。可是这样会有bug，毕竟这个规则写得很死呀！比如说，咩有写ipad样式，那么ipad就真得没有被适配的样式了。

   ![1563158201511](img/07/1563158201511.png)

3. 只给一个最小值。例如，假如屏幕尺寸是580px的话，那就会应用ipad的样式了，而默认的phone的样式会被层叠掉。同理，如果是780px的话，那么就属于n-pc的范围了，于是就会应用n-pc的样式。当然这前提是，col标签有5个需要适配的类，可是如果用户咩有写ipad类呢？即没有ipad样式，那么580px就会往下走选择phone的样式了。（退而求其次姿势）

理解这个图之后，你就能从形象上理解这个适配代码了：

```scss
.col {
    $class-prefix: col-;
    @for $n from 1 through 24 {
      &.#{$class-prefix}#{$n} {
        width: ($n / 24) * 100%;
      }
    }

    $class-prefix: offset-;
    @for $n from 1 through 24 {
      &.#{$class-prefix}#{$n} {
        margin-left: ($n / 24) * 100%;
      }
    }
 
    // 适配5种屏幕尺寸的设备：
    // 默认是all类型的，我认为不同屏幕尺寸下可以不用24个格子，可以选择16、12这样的

    // sm
    @media (min-width: 576px) {
      $class-prefix: col-ipad-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          width: ($n / 24) * 100%;
        }
      }
      $class-prefix: offset-ipad-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          margin-left: ($n / 24) * 100%;
        }
      }
    }

    // md
    @media (min-width: 768px){
      $class-prefix: col-narrow-pc-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          width: ($n / 24) * 100%;
        }
      }
      $class-prefix: offset-narrow-pc-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          margin-left: ($n / 24) * 100%;
        }
      }
    }

    // lg
    @media (min-width: 992px) {
      $class-prefix: col-pc-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          width: ($n / 24) * 100%;
        }
      }
      $class-prefix: offset-pc-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          margin-left: ($n / 24) * 100%;
        }
      }
    }

    // xl
    @media (min-width: 1200px) {
      $class-prefix: col-wide-pc-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          width: ($n / 24) * 100%;
        }
      }
      $class-prefix: offset-wide-pc-;
      @for $n from 1 through 24 {
        &.#{$class-prefix}#{$n} {
          margin-left: ($n / 24) * 100%;
        }
      }
    }

  }
```







