---
typora-copy-images-to: img\11
---

# 简单轮子：手风琴组件

## ★课程简介

手风琴组件

代码：

`Collapse` <https://github.com/FrankFang/frank-test-1/blob/callapse/src/collapse.vue>
`CollapseItem` <https://github.com/FrankFang/frank-test-1/blob/callapse/src/collapse-item.vue>
`test` <https://github.com/FrankFang/frank-test-1/blob/callapse/test/collapse.test.js>

UI： <https://www.yuque.com/u29422/gulu/268969>

## ★简单介绍

### ◇功能是怎样的

可以折叠/展开的内容区域。它也被称作 Collapse 折叠面板：

![1566750280120](img/11/1566750280120.png)

可见，因为该组件有着折叠展开的调调（琴键这块区域就是title啦！而像纸扇子那部分就是展开的内容啦！），所以才叫它手风琴组件

### ◇何时使用它

- 对复杂区域进行分组和隐藏，保持页面的整洁。
- `手风琴` 是一种特殊的折叠面板，只允许单个内容区域展开。

### ◇常见使用场景

- 搜索某个中文词语的意思：

  ![qJ3BU1Q3gI](img/11/qJ3BU1Q3gI.gif)

- ……

## ★创建手风琴组件

### ◇collapse 的 基本样式 和 基本功能

- 注意点：
  - 为了让样式更直观，请放大网页到200%，而不是150%、250%；200%这个倍数，边框的显示才是正确的！
  - 边框线的合并需要注意一下！
  - 话说，用 `v-show`会不会好点？如果用 `v-show`的话，样式又得改一下了，而且 `:last-child`的妙用就无法体现出来了！
- API 设计：

```html
<g-collapse>
  <g-collapse-item title="标题1">内容1</g-collapse-item>
  <g-collapse-item title="标题2">内容2</g-collapse-item>
  <g-collapse-item title="标题3">内容3</g-collapse-item>
</g-collapse>
```

- 功能：

  - 点开一个title，显示一个内容；注意，这是可以同时打开多个内容的！

- 思路：

  - 点击title，意味着创建了一个DOM元素，再次点击title，意味着一个DOM元素被移除了
  - 样式参照[ant-design](https://ant.design/components/collapse-cn/)的，注意 `:last-child`这个伪类的巧妙运用！

- 效果：

  ![TiJjwIvZk3](img/11/TiJjwIvZk3.gif)

### ◇添加 single 选项





## ★总结

- 以怎样的视角去看待这个手风琴组件：可以把Collapse看做是`ul`，而CollapseItem则是`li`。在看这节内容的时候，我刚好看了芳芳的 React 入门课，在这节课我了解到了，组件就是可组合的东西， React 写一个DOM很简单，操作DOM的姿势是原生的，而 Vue 用的是指令呀！ React 添加props很简单，构成一个函数组件即可！至此，我可以把我们写的一个个 `.vue`文件看做是一个个函数，其中props就是形参，即需要接收外边写在自定义标签身上的属性，而data看做是 React 的useState，data它维护了组件的状态，就像是一个局部变量一样！不管怎么说， React 真得很简洁，如语法简洁等，而 Vue 则是有很多约定，如方法需要写在`methods`、在某个组件里边使用xx组件需要注册xx组件等等……我们需要在 `#app`这个root组件里边注册两个组件 `Collapse`和 `CollapseItem`，才能使用这些组件，而 React 很多时候可以把多个组件都写在一起！反正都是函数组件，而 Vue 则是单文件组件！

  总之， React 就是 JS in HTML，而 Vue 则是搞点指令、变量、表达式、单行语句在HTML上。

- 主动去提一个问题比人家给你一个问题要好得多！

- 不管你在思考问题的时候，还是在做什么的时候，你的脑海都得有个大局观才行，不然你很容易迷失在细节里里边，然后就会不知道自己到底想解决啥问题，到底想做什么，到底想要什么结果！

## ★Q&A

### ①单向数据流？

> 引子：这个手风琴组价用到了这个设计模式



**➹：**[双向绑定 - 廖雪峰的官方网站](https://www.liaoxuefeng.com/wiki/1022910821149312/1109527162256416)



### ②UI 控件是啥？

比如按钮、输入框、分页等

说白了就是我们写的UI组件，毕竟控件是组件的一种，全称叫“控制组件”，而且控件一定有UI外型，一定看得到

**➹：**[iOS - - UI控件基本介绍 - 简书](https://www.jianshu.com/p/fa633f5bd368)

**➹：**[控件与组件的区别 - btwsmile's blog - CSDN博客](https://blog.csdn.net/ixsea/article/details/6658220)

**➹：**[这4个最常见的 UI 组件，给你总结了这份使用指南 - 优设网 - UISDC](https://www.uisdc.com/4-common-ui-component-guides)

### ③应用软件界面结构和源码目录结构？

> 界面：
>
> - *名词*，物体和物体相接触的面。 「缩小 界面，减少摩擦」
> - *名词*，用户界面的简称。

![](img/11/1566734111836.png)

打开微信这个软件，你会看到有「微信」、「通讯录」、「发现」、「我」这四个大模块

拿「发现」这个模块来说，它里边还有小模块，如「朋友圈」、「扫一扫」、「摇一摇」等

每个模块都有各自的功能集合！

关于流程，可以理解为一个动作，如「我要发朋友圈」这个动作，该怎么做呢？

点开朋友圈，点开那个照相机按钮，上传一张图片，配上一些文本内容，然后点击发表，就可以看到朋友圈里边有你刚刚发的消息了！

关于页面，你在朋友圈里边看到的内容就是整个页面！

关于组件，你在朋友圈里边看到的「照相机」可以认为是个上传组件，看到的头像是个头像组件，看到一个朋友的动态，那就是信息列表组件啦！

作为前端开发者，在做工程化的时候，都得模块化开发，如开发一个 Vue 项目，一个单文件组件可以看做是一个模块，对组件的交互可看做是个流程，一个动作！

**➹：**[应用软件界面结构和源码目录结构 - 简书](https://www.jianshu.com/p/a48594fb3a74)

**➹：**[Vue项目组织规范 - 简书](https://www.jianshu.com/p/75cf57e53451)

**➹：**[「介面」和「界面」有什么区别？ - 知乎](https://www.zhihu.com/question/19905127)

### ④约定优于配置？

> 首先 **约定>配置** 不是什么**程序语言**，只是一种方式。
>
> 约定，什么是约定？男生上左边的厕所，女生上右边的厕所，然后按照男左女右的默认约定给厕所配置挂牌。约定就是当没有做任何设置的时候，按照常规的默认设置。
>
> 配置，什么是配置？每次上厕所前，先配置左边的到底是男厕所还是女侧...
>
> 约定大于配置，就是尽量按照**常规**做好默认设置，而不是没有任何设置，必需手动配置方可运行。
>
> 不是说约定就没有配置，约定只是给定了**常规默认设置**而已，可以进行修改配置。
>
> 对于新手，使用默认设置可以快速上手，降低难度。对于熟手，可以调整各类配置，更适应自己的独特需求。

 Vue 给我的赶脚就是约定优于配置！

**➹：**[如何评价“约定优于配置”的程序语言? - 知乎](https://www.zhihu.com/question/47239663)

### ⑤关于 Vue 的template元素？

平时使用template元素：

```html
  <template id="tem">
    <div id="app">
      <h1 id="title">hello world!</h1>
    </div>
  </template>
  <script type="text/javascript">
    var tem = document.getElementById("tem");//获取template标签
    console.log(tem);
    console.log(tem.innerHTML);  //string类型的返回值
    var title = tem.content.getElementById("title"); //在template标签内部内容，必须要用.content属性才可以访问到
    console.log(title);
  </script>
```

结果页面一片空白，而log的结果是这样的：

![1566790103109](img/11/1566790103109.png)

为啥页面看不到内容呢？因为`template`元素的 `display`属性值为 `none`啊！ 布局树上不会出现 `display:none`的元素！

---

关于render树：

> render 树是 HTML 文档的可视化表现，是由可视化元素按顺序展示组成的。换句话说 render 树和 DOM 树上的节点并非一一对应的，那这里有两个概念：可视化元素和非可视化元素。
>
> **非可视化元素**：或是`<head>`元素、或是样式`display:none`的元素。 **可视化元素**：大多数标签，大多数样式，特别说明 `visibility:hidden`也是。

简单了解一下各种树的构建：

1. 处理 HTML 标记并构建 DOM 树。
2. 处理 CSS 标记并构建 CSSOM 树。
3. 将 DOM 与 CSSOM 合并成一个渲染树。
4. 根据渲染树来布局，以计算每个节点的几何信息。
5. 将各个节点绘制到屏幕上。

---

言归正传，template元素的存在意义是啥？或者说它是为了解决什么问题而出现的

> HTML `template` 元素是一种用于保存客户端内容的机制，该内容在页面加载时不被渲染，但可以在运行时使用 JavaScript 进行实例化。
>
> 可以将一个模板视为正在被存储**以供随后在文档中使用的一个内容片段**。
>
> 虽然, 在加载页面的同时,解析器确实处理 `template`元素的内容，这样做只是确保这些内容是有效的; 然而,元素的内容不会被渲染。

说白了就是可以让我把需要进行大量重排和重绘的操作扔到template里边去了，然后通过 JS 一次性创建它们，扔到页面里边显示它们！

在  `.vue`里边使用template：

```vue
<template>
  <div class="collapse">
    <slot></slot>
  </div>
</template>
```

这里最外层template表示api里的`template: '字符串模板'`

如果内存写了template，那么就是要配合`v-if`，`v-for`做分组使用的

比如说：

```html
<div v-if="show">hi</div>
```

这只能显示控制一个元素是否显示

如果你想切换多个元素，那么你可以把一个 `<template>` 元素当做不可见的包裹元素，并在上面使用 `v-if`。最终的渲染结果将不包含 `<template>` 元素。

```html
<template v-if="ok">
  <h1>Title</h1>
  <p>Paragraph 1</p>
  <p>Paragraph 2</p>
</template>
```



**➹：**[渲染树-理论剖析 - 掘金](https://juejin.im/post/5c6d3d4df265da2dd218c584)

**➹：**[`template`：内容模板元素 - HTML（超文本标记语言） - MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/template)

**➹：**[HTML5 `template` 标签元素简介 « 张鑫旭-鑫空间-鑫生活](https://www.zhangxinxu.com/wordpress/2014/07/hello-html5-template-tag/)

**➹：**[API — Vue.js](https://cn.vuejs.org/v2/api/index.html#template)

**➹：**[条件渲染 — Vue.js](https://cn.vuejs.org/v2/guide/conditional.html#%E5%9C%A8-lt-template-gt-%E5%85%83%E7%B4%A0%E4%B8%8A%E4%BD%BF%E7%94%A8-v-if-%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%88%86%E7%BB%84)

**➹：**[列表渲染 — Vue.js](https://cn.vuejs.org/v2/guide/list.html#%E5%9C%A8-lt-template-gt-%E4%B8%8A%E4%BD%BF%E7%94%A8-v-for)

**➹：**[vue中的template标签 - u013594477的专栏 - CSDN博客](https://blog.csdn.net/u013594477/article/details/80774483)

**➹：**[Vue中v-if和v-show的使用场景 - 知乎](https://zhuanlan.zhihu.com/p/38179618)

**➹：**[documentFragment和template - 简书](https://www.jianshu.com/p/ebe8e26076dc)

**➹：**[DocumentFragment 的优化小知识 - 掘金](https://juejin.im/post/590f4eadac502e006cf718c3)

**➹：**[前端面试题-display:none和visibility:hidden的区别 - 前端の进行时 - SegmentFault 思否](https://segmentfault.com/a/1190000013929168)

**➹：**[vue.js - template标签在vue组件中扮演怎样的角色？ - SegmentFault 思否](https://segmentfault.com/q/1010000013916280)

### ⑥回流（reflow）和 重绘（repaint）?

![1566789902842](img/11/1566789902842.png)



来自若愚老师的总结：

> repaint： 可以把屏幕当成一幅画，只要显示的东西变了就需要重新画一次
>
> reflow: 重新计算位置大小等，重在“计算”，比如加了margin，元素位置都变了，需要重新计算一次。 当然也需要重新画一次

自己的总结：

> reflow，render树到布局树的过程，这是需要计算的
>
> repaint，布局树到渲染到页面的过程！根据给出的数据，依葫芦画瓢直接画就好了！

有这样一个问题，能否「根据子元素的 特定class 写父元素的样式吗?」

这种姿势，css不支持，未来也不会支持，因为这样会在渲染的时候造成极大的性能消耗。毕竟假如爸爸样式改变了，那么继承自爸爸的样式的儿子们，样式也会改变，既然样式改变了，假如这样式涉及计算方面的，那么就会造成极大的重排重绘

**➹：**[CSS Triggers](https://csstriggers.com/)

**➹：**[网页性能管理详解 - 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html)

### ⑦chrome浏览器开发者的 Elements面板的内容是DOM树吗？

CSS实际上时如何工作的？

当浏览器显示文档时，它必须将文档的内容与其样式信息结合。它分两个阶段处理文档：

1. 浏览器将 [HTML](https://developer.mozilla.org/en-US/docs/Glossary/HTML) 和 [CSS](https://developer.mozilla.org/en-US/docs/Glossary/CSS) 转化成 [DOM](https://developer.mozilla.org/en-US/docs/Glossary/DOM) （*文档对象模型*）。DOM在计算机内存中表示文档。它把文档内容和其样式结合在一起。
2. 浏览器显示 DOM 的内容。

![img](img/11/rendering.svg)

所以说Elements面板的内容就是DOM树咯！或者应该是DOM树和CSSOM树结合的render树

对于 `display:none;`的元素，我们可以在render树里边看到，但是在布局树（计算最终CSS样式才会构建布局树）里边是看不到的。

一般而言：

> 一个DOM节点得到一个LayoutObject。但是有时候LayoutObject没有节点，或者节点没有LayoutObject。
>
> 一个节点甚至可以拥有多个LayoutObject。
>
> DOM节点大多与布局对象1:1，但也有一些例外。如这个元素是 `display:none`、或者这伪元素就没有DOM节点！

总之，就是元素是 `display:none;`的，那么它就是咩有布局对象，没有布局对象，那么在页面就会看不到！伪元素没有DOM节点，用个 `::before`之类表示的，但是我们通过样式计算，是能够在布局树里边生成一个布局对象，因此它是在页面可见的！

所以，当你在看Elements面板的内容时，发现，明明有这个DOM，但是页面就是不显示它，那么很有可能就是样式的问题了！

补充，head元素的display为none，而html元素和body元素都是block！说白了，head元素就是非可视化元素

**➹：**[编辑样式以及 DOM - Chrome 开发者工具教程 - W3xue.com](https://www.w3xue.com/soft/chromef12/chromef12-edit-cssdom.html)

**➹：**[CSS如何工作 - 学习 Web 开发 - MDN](https://developer.mozilla.org/zh-CN/docs/Learn/CSS/Introduction_to_CSS/How_CSS_works)

**➹：**[Life of a Pixel - fe-learn-2018](https://ppambler.github.io/fe-learn-2018/Chrome/01-life-of-a-pixel.html#layout)

**➹：**[渲染树构建、布局及绘制  -  Web  -  Google Developers](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction)

**➹：**[深入浅出动画帧 - 三羊的小站](https://snayan.github.io/post/2019/in_depth_animation_frame/)

### ⑧ `el:last-child`的用法？

`:last-child`有「且」的含义吗？

如果一个元素的结构是这样的：

```html
<div> 
  <p></p>
</div>

<style>
  div > p:last-child {
   	color: red;
  }
</style>
```

p元素是div的最后一个儿子吧！那么 `div > p:last-child`就会匹配

假如结构是这样的呢？

```html
<div> 
  <p></p>
  <div></div>
</div>
```

那还会匹配吗？

不会呀！

言归正传，它的用法如下：

`el:last-child` 的匹配规则是：

第一步，查找 el 选择器匹配元素的所有同级元素（siblings）；（查找p元素的所有同级元素，即这个div元素）

第二步，在同级元素中查找最后一个元素；（找到了div元素）

第三步，检验最后一个元素是否与选择器 el 匹配。（div元素不等于p元素，所以 `div > p:last-child`就不会被匹配到）

总之，`:last-child`选择器用来匹配父元素中最后一个子元素。（关键在于，元素是最后一个的，而不是同类型元素的最后一个！）

而且，`p:last-child`等同于`p:nth-last-child(1)`

**➹：**[CSS3 :last-child 选择器 - 菜鸟教程](https://www.runoob.com/cssref/sel-last-child.html)

**➹：**[css - 为什么选择器:last-child没有起作用? - SegmentFault 思否](https://segmentfault.com/q/1010000011647969)

**➹：**[:last-child - CSS（层叠样式表） - MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/:last-child)

