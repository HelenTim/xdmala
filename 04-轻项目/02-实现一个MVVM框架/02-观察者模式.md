---
typora-copy-images-to: img\02
---

# 观察者模式

## ★简介

> 理解观察者模式
>
> 项目代码： <https://github.com/jirengu/wheel-mvvm>









## ★总结

## ★Q&A

### ①观察者模式与发布订阅者模式是否有不同？

一个误区：

> *Publishers + Subscribers = Observer Pattern*

根据这条公式，你会认为它们俩是一样的，但其实它们是不一样的！接下来我们将会通过一些鸟瞰图来形象地理解它们俩的不同

**①观察者模式**

Observer姿势是这样的：

![](img/02/1.png)

解释一波：

xxx正在找工作，于是就在招聘网站上找啊找，偶然看到一家心仪的公司，于是你就联系了那家公司的hr，并把自己的联系方式给了hr，而hr也对你表示「如果公司有这个职位空缺的话，我们会联系你的」，当然，这个世界总有人跟你做同样的事儿，即他们都是关于这个职位的竞争者。

在这里hr就是Subject啦！管理着这些职位竞争者，一旦公司某个部门说该职位空缺了，那么hr就会去通知这些竞争者们去面试啦！

因此，如果你的代码实现了上述类似的过程，那么你就可以说你的软件或者应用程序用到了「观察者设计模式」

观察者模式中的Subject类似于Publisher（发布者），而Observer则可以完全与Subscriber（订阅者）相关。Subject通知Observe，就像是Publisher通知它的Subscriber那样，这就是为啥大多数设计模式书籍或文章使用功能「Publisher-Subscriber」来解释观察者设计模式。

**②发布订阅模式**

然而还有另外一种流行的模式叫做「Publisher-Subscriber」，这种模式在概念上与观察者模式非常相似，当然，真正的「Publisher-Subscriber」模式和「Observer」模式之间还是有主要的区别的。

在真正的「Publisher-Subscriber」模式中，**publishers**（信息发送者）不会直接把信息发给**subscribers**（信息接收者），这意味着发布者和订阅者不知道彼此的存在，因此这当中必定会存在第三个组件，而这个组件可以被称为**broker**（代理、经纪人）或**message broker** （消息代理）或**event bus**（事件总线），而发布者和订阅者都知道这个组件，总之，这个组件就是过滤掉所有传入的消息并相应地分发给那些订阅者们。

换句话说，pub-sub是用于在不同系统组件之间传递消息的模式，而这些组件不知道关于彼此身份的任何信息。 

那么**broker**是如何过滤掉所有的消息呢？ 实际上，这其中有几个消息过滤过程。而最常用的方法是：**Topic-based**和**Content-based**，如果你感兴趣可以看看这个：

**➹：**[Publish–subscribe pattern - Wikipedia](https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern#Message_filtering)

一张图解释何为 「Pub-Sub Pattern」：

![](img/02/2.gif)

> 通信基础施设

**③它们俩的主要区别如下：**

![img](img/02/3.jpeg)

**④结论：**

-  在观察者模式中，**Observers**知道**Subject**的存在，当然，Subject也保存有Observes的记录。 然而，在发布者/订阅者中，发布者和订阅者不需要彼此了解。 它们只是在消息队列或代理（broke）的帮助下进行通信。
- 在Publisher / Subscriber模式中，组件之间是松耦合的（loosely coupled），Observer模式则与之相反，即它们俩互相依赖
-  观察者模式主要以同步（**synchronous**）姿势实现，即当某些事件发生（occurs）时，Subject就会调用其所有 observers的适当的方法。 而发布者/订阅者模式主要以异步（**asynchronous** ）姿势实现（使用消息队列）。
- 观察者模式需要在单个应用程序的地址空间中实现。 而另一方面的发布者/订阅者模式则更像是跨应用程序模式。

尽管这些模式之间存在差异，但有些人可能会说发布者 - 订阅者模式是观察者模式的变体，因为它们之间存在概念上的相似性。因此，你说发布者-订阅者模式为观察者模式，其实也没啥错的啊！毕竟它们俩就是如此的形似！这就像是樱桃和车厘子，只是车厘子留过洋你就说它们俩不一样吗？

**➹：**[鸟瞰图的意义在于什么？ - 知乎](https://www.zhihu.com/question/26776553)

**➹：**[Observer vs Pub-Sub pattern – Hacker Noon](https://hackernoon.com/observer-vs-pub-sub-pattern-50d3b27f838c)

**➹：**[观察者模式 vs 发布订阅模式 - 知乎](https://zhuanlan.zhihu.com/p/51357583)

